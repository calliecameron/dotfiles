#!/bin/bash
# Either ls or less, depending on context

set -eu

# Use the user's pager if specified, else fall back to less
USE_PAGER='less'
if [ -n "${PAGER:-}" ]; then
    USE_PAGER="${PAGER}"
fi

if [ -n "${2:-}" ]; then
    # Two or more args; always ls
    exec ls "${@}"
elif [ -n "${1:-}" ]; then
    # One arg; ls if it begins with a dash or is a directory, less otherwise
    if [[ "${1}" == '-'* ]] || [ -d "${1}" ]; then
        exec ls "${@}"
    else
        exec "${USE_PAGER}" "${@}"
    fi
else
    # No args; less if something is being piped, else ls
    if tty -s; then
        exec ls
    else
        exec "${USE_PAGER}"
    fi
fi
