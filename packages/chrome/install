#!/bin/bash

set -eu

if ! command -v google-chrome &>/dev/null; then
    wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
    TMPDIR="$(mktemp -d)"
    wget -O "${TMPDIR}/chrome.deb" https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
    sudo apt-get -y --fix-broken install "${TMPDIR}/chrome.deb"
    rm "${TMPDIR}/chrome.deb"
    rmdir "${TMPDIR}"
fi

sed 's|/usr/bin/google-chrome-stable|/usr/bin/google-chrome-stable --password-store=gnome-libsecret|g' \
    <"/usr/share/applications/google-chrome.desktop" \
    >"${HOME}/.local/share/applications/google-chrome.desktop"

xdg-desktop-icon install --novendor "${HOME}/.local/share/applications/google-chrome.desktop"
