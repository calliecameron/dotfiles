#!/bin/bash

set -eu

function send-emacs-term-command() {
    local CMD="${1}"

    if [ "${TERM:0:5}" = 'eterm' ]; then
        env printf "${CMD}"
    elif {
        [ "${TERM:0:4}" = 'tmux' ] ||
            { [ "${TERM:0:5}" = 'screen' ] && [ -n "${TMUX:-}" ]; }
    } && [[ "$(tmux display-message -p '#{client_termname}')" =~ ^eterm ]]; then
        # shellcheck disable=SC1003
        env printf "\033Ptmux;\033${CMD}\033\\"
    fi
}

send-emacs-term-command "\033AnSiTu $(id -un)\n"
send-emacs-term-command "\033AnSiTh ${EMACS_PROMPT_HOSTNAME}\n"
send-emacs-term-command "\033AnSiTc $(pwd)\n"
