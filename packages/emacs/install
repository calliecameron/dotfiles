#!/bin/bash

set -eu

dotfiles-nix-install emacs-gtk

dotfiles-clone-or-update-repo 'https://github.com/calliecameron/emacs-launchers' \
    "${PACKAGE_INSTALL_DIR}/emacs-launchers" 'main'

sed "s|@@@@@1@@@@@|${PACKAGE_INSTALL_DIR}/emacs-launchers/bin|g" <"${PACKAGE_SOURCE_DIR}/emacs-daemon-desktop-template" |
    sed "s|@@@@@2@@@@@|${PACKAGE_SOURCE_DIR}|g" >"${PACKAGE_INSTALL_DIR}/emacs-daemon.desktop"
xdg-desktop-menu install --novendor "${PACKAGE_INSTALL_DIR}/emacs-daemon.desktop"
xdg-desktop-icon install --novendor "${PACKAGE_INSTALL_DIR}/emacs-daemon.desktop"
xdg-mime default emacs-daemon.desktop \
    text/english \
    text/plain \
    text/x-makefile \
    text/x-c++hdr \
    text/x-c++src \
    text/x-chdr \
    text/x-csrc \
    text/x-java \
    text/x-moc \
    text/x-pascal \
    text/x-tcl \
    text/x-tex \
    application/x-shellscript \
    text/x-c \
    text/x-c++ \
    text/markdown
mkdir -p "${HOME}/.config/autostart"
cp "${PACKAGE_INSTALL_DIR}/emacs-daemon.desktop" "${HOME}/.config/autostart/emacs-daemon.desktop"
