#!/bin/bash

set -eu

function usage() {
    echo "Usage: $(basename "${0}") light|dark" >&2
    exit 1
}

test -z "${1:-}" && usage
THEME="${1}"

KONSOLE_PROFILE='Dotfiles'
KONSOLE_PROFILE_DIR="${HOME}/.local/share/konsole"
KONSOLE_PROFILE_FILE="${KONSOLE_PROFILE_DIR}/${KONSOLE_PROFILE}.profile"

function set-theme() {
    plasma-apply-lookandfeel --apply "${1}"

    mkdir -p "${KONSOLE_PROFILE_DIR}"
    kwriteconfig5 --file "${KONSOLE_PROFILE_FILE}" --group General --key Name "${KONSOLE_PROFILE}"
    kwriteconfig5 --file "${KONSOLE_PROFILE_FILE}" --group General --key Parent 'FALLBACK/'
    kwriteconfig5 --file "${KONSOLE_PROFILE_FILE}" --group Appearance --key ColorScheme "${2}"
    kwriteconfig5 --file "${HOME}/.config/konsolerc" --group 'Desktop Entry' --key DefaultProfile "${KONSOLE_PROFILE}.profile"

    kwriteconfig5 --file "${HOME}/.config/kwriterc" --group 'KTextEditor Renderer' --key 'Auto Color Theme Selection' --type bool false
    kwriteconfig5 --file "${HOME}/.config/kwriterc" --group 'KTextEditor Renderer' --key 'Color Theme' "${3}"
}

if [ "${THEME}" = 'light' ]; then
    set-theme 'org.kde.breeze.desktop' 'SolarizedLight' 'Solarized Light'
elif [ "${THEME}" = 'dark' ]; then
    set-theme 'org.kde.breezedark.desktop' 'Solarized' 'Solarized Dark'
else
    usage
fi
